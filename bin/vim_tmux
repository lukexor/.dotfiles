#! /usr/bin/env perl

use strict;
use warnings;

use Cwd;

# We'll build up our command since every command has to succeed
my $cmd = "";
# See if we can find an existing editor window
if (!`tmux list-windows | grep "1: editor"`) {
	# If not, create one and swap to make it first
	$cmd .= "tmux new-window -n editor -k -d -t1 vim @ARGV";
} else {
    # tmux switch -t $(tmux list-panes -a -F '#{session_name}:#{window_index}.#{pane_index} #{pane_tty}'|grep $(ps -o tty= -p $(pgrep -f '^vim')) | awk '{ print $1 }')
    # Find the absolute path to our desired files
    for my $filename (@ARGV) {
        my $file = Cwd::abs_path($filename) || $filename;
        chomp $file;
        if (length $file > 0) {
            my $cwd = Cwd::getcwd;
            $cmd .= " && " if $cmd;
            $cmd .= "tmux send-keys -t editor Escape ':e $file' Enter";
        }
    }
}
# Finally, switch and pipe to /dev/null
$cmd .= " && " if $cmd;
$cmd .= "tmux find-window -N editor";
# $cmd .= " && tmux swap-window -t 1 2>/dev/null";
# Print and execute
print $cmd . "\n";
system($cmd)
